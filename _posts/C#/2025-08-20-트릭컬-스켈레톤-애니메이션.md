---
title: "트릭컬 스켈레톤 애니메이션"
excerpt: "Spine-Unity 패키지를 이용한 트릭컬 스켈레톤 애니메이션"

categories:
  - Unity

permalink: /Unity/trickcal/

toc: true
toc_sticky: true

date: 2025-08-20
last_modified_at: 2025-08-20
---

포폴 대비 단편적인 기능 구현 연습도 해볼겸 트릭컬 에셋으로 라투디를 시도해봤다.\
라투디는 보통 Spine을 이용하던데 유료다보니 이것저것 찾아보다 유니티 패키지를 하나 찾아냈다.\
처음엔 'Spine-Unity 패키지' 4.2버전을 받았었는데 트릭컬 에셋 열어보려 하니까 버전이 안맞는다고 4.1로 내리라 하더라.\
에셋 자체도 유니티 게임이다보니 AssetStudioGUI로 쉽게(?) 뜯긴 했는데 트릭컬이 나무위키에 적힌 거랑 다르게 버전업을 했는지, 에셋스튜디오도 버전업이 필요했음.

## SkeletonDataAsset

{이미지 넣을 것}

임포트한 패키지를 통해 에셋을 살펴보니 기본적으로 에셋에 스킨이랑 애니메이션 정보가 다 들어가 있었다.\
이대로 -완-칠 순 없으니 외부 버튼으로 조작할 수 있도록 해보기로 했다.

<br>

## Skeleton Animation

추출한 에셋은 전투가 아니라 로비, 스토리 등에 이용되는 스탠딩 일러였기 때문에 감정표현 애니메이션 클립이 들어있었는데, 대부분은 두 개 이상의 클립을 가지고 있었다.\
그래서 '사도면접'처럼 감정표현별로 클립을 그룹화해서 하나의 버튼으로 여러 애니메이션을 재생할 수 있도록 했다.

### 애니메이션 그룹화

하나의 감정표현이 여러 개의 클립을 들고있을 수 있으니 List보단 Dictionary로 관리하기로 했다.

```cs
Dictionary<string, List<string>> Clips = new Dictionary<string, List<string>>()

private void BuildGroups()
{
    Clips.Clear();
    var data = dataAsset.GetSkeletonData(true);
    if (data == null) return;

    for (int i = 0; i < data.Animations.Count; ++i)
    {
        string clip = data.Animations.Items[i].Name;
        string key = ExtractPrefix(clip);

        if (!Clips.TryGetValue(key, out var list))
        {
            list = new List<string>();
            Clips[key] = list;
        }
        list.Add(clip);
    }
}
```


### 접두사 추출

클립은 **{상태}_{번호}**의 규칙을 가지고 있었기 때문에, _를 찾아서 그 앞까지 문자열을 추출하여 Dictionary의 Key로 설정했다. 

```cs
private string ExtractPrefix(string name)
{
    if (string.IsNullOrEmpty(name)) return "";

    int i = name.IndexOf('_');
    return (i > 0) ? name.Substring(0, i) : name;
}
```


### 애니메이션 사이클

일단 지금은 버튼을 누르면 차례대로 재생되도록 했다.\
마지막 애니메이션이 재생되면 그 다음은 처음으로 돌아오도록 구현했다.

```cs
public void CycleState(string stateKey)
{
    Clips.TryGetValue(stateKey, out var clips);
    int nextIdx = NextIdx.TryGetValue(stateKey, out var savedIdx) ? savedIdx : 0;

    string clip = clips[nextIdx];
    animState.SetAnimation(0, clip, loop);

    curStateKey = stateKey;
    curVariantIdx = nextIdx;

    NextIdx[stateKey] = (nextIdx + 1) % clips.Count;
}
```

## 스킨

스킨이라 적혀있긴 했지만 타입이나 버전에 더 가까운 느낌이다.\
버터의 경우, 'default, Normal, Gun' 이렇게 세 종류를 가지고 있었는데, 
